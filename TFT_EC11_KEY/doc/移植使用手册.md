# TFT_EC11_KEY 移植使用手册

## 1. 硬件要求

### 1.1 EC11旋转编码器
- 增量式旋转编码器
- 带按键功能
- 5V或3.3V供电

### 1.2 MCU最低要求
- STM32F4系列或兼容MCU
- 至少3个GPIO(2个外部中断+1个普通输入)
- 1个定时器(用于系统滴答)

### 1.3 显示器
- 支持U8G2库的任意显示器
- I2C或SPI接口

## 2. 软件移植步骤

### 步骤1: 复制源文件
将以下文件复制到你的项目:
- `bsp/bsp_ec11.c/h`
- `bsp/bsp_key.c/h`
- `middleware/menu_core.c/h`

### 步骤2: 修改引脚定义

编辑 `bsp_ec11.h`:
```c
#define EC11_A_GPIO_PORT        GPIOA
#define EC11_A_GPIO_PIN         GPIO_Pin_0
// ... 根据实际硬件修改
```

### 步骤3: 实现时间戳函数

在你的board.c中实现:
```c
uint32_t bsp_ec11_get_tick(void)
{
    return system_tick_ms;  // 返回系统运行毫秒数
}
```

### 步骤4: 创建菜单

参考 `app/main.c` 中的示例

### 步骤5: 主循环调用

```c
while(1) {
    bsp_ec11_scan();
    bsp_key_scan();
    delay_ms(10);
}
```

## 3. API参考

### 3.1 EC11编码器API

#### bsp_ec11_init()
初始化EC11编码器

#### bsp_ec11_scan()
扫描EC11状态，返回事件

#### bsp_ec11_register_callback()
注册事件回调函数

### 3.2 菜单系统API

#### menu_init()
初始化菜单系统

#### menu_move_up/down()
菜单上下移动

#### menu_enter()
确认/进入

#### menu_back()
返回/退出

## 4. 常见问题

### Q1: EC11转动没有响应?
- 检查引脚定义是否正确
- 确认外部中断配置成功
- 检查是否调用了bsp_ec11_scan()

### Q2: 菜单显示不正常?
- 确认display_callback函数已实现
- 检查U8G2初始化是否成功

### Q3: 如何调试?
- 在回调函数中添加打印语句
- 使用示波器查看EC11信号

## 5. 示例代码

完整示例见 `app/main.c`

## 6. 技术支持

提交Issue到GitHub仓库
